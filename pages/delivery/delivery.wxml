<!--pages/delivery/delivery.wxml-->
<view class="container">
  <!-- æœç´¢å’Œç­›é€‰ -->
  <view class="search-section">
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="æœç´¢é€è´§å•å·æˆ–é…é€å‘˜" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="handleSearch"
      />
      <text class="search-btn" bindtap="handleSearch">ğŸ”</text>
    </view>
    
    <view class="filter-tabs">
      <view 
        class="filter-tab {{currentStatus === '' ? 'active' : ''}}" 
        bindtap="filterByStatus" 
        data-status=""
      >
        å…¨éƒ¨
      </view>
      <view 
        class="filter-tab {{currentStatus === 'pending' ? 'active' : ''}}" 
        bindtap="filterByStatus" 
        data-status="pending"
      >
        å¾…é…é€
      </view>
      <view 
        class="filter-tab {{currentStatus === 'in_progress' ? 'active' : ''}}" 
        bindtap="filterByStatus" 
        data-status="in_progress"
      >
        é…é€ä¸­
      </view>
      <view 
        class="filter-tab {{currentStatus === 'completed' ? 'active' : ''}}" 
        bindtap="filterByStatus" 
        data-status="completed"
      >
        å·²å®Œæˆ
      </view>
    </view>
  </view>

  <!-- é€è´§å•åˆ—è¡¨ -->
  <view class="delivery-list" wx:if="{{deliveries.length > 0}}">
    <view 
      class="delivery-item" 
      wx:for="{{deliveries}}" 
      wx:key="_id"
      bindtap="navigateToDeliveryDetail"
      data-id="{{item._id}}"
    >
      <view class="delivery-header">
        <text class="delivery-number">{{item.deliveryNo}}</text>
        <text class="tag tag-{{item.status}}">{{deliveryStatusText[item.status]}}</text>
      </view>
      
      <view class="delivery-content">
        <view class="delivery-info">
          <text class="employee-name">é…é€å‘˜ï¼š{{item.employeeName}}</text>
          <text class="delivery-date">{{item.createTime}}</text>
        </view>
        
        <view class="delivery-summary">
          <text class="order-count">{{item.orders ? item.orders.length : 0}}ä¸ªè®¢å•</text>
          <text class="total-amount">Â¥{{item.totalAmount}}</text>
        </view>
      </view>
      
      <view class="delivery-footer">
        <view class="delivery-actions">
          <button 
            class="btn btn-secondary btn-sm" 
            bindtap="handleEditDelivery" 
            data-id="{{item._id}}"
            catchtap="true"
          >
            ç¼–è¾‘
          </button>
          <button 
            class="btn btn-primary btn-sm" 
            bindtap="handleStartDelivery" 
            data-id="{{item._id}}"
            catchtap="true"
            wx:if="{{item.status === 'pending'}}"
          >
            å¼€å§‹é…é€
          </button>
          <button 
            class="btn btn-success btn-sm" 
            bindtap="handleCompleteDelivery" 
            data-id="{{item._id}}"
            catchtap="true"
            wx:if="{{item.status === 'in_progress'}}"
          >
            å®Œæˆé…é€
          </button>
          <button 
            class="btn btn-danger btn-sm" 
            bindtap="handleCancelDelivery" 
            data-id="{{item._id}}"
            catchtap="true"
            wx:if="{{item.status === 'pending'}}"
          >
            å–æ¶ˆ
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:else>
    <text class="empty-icon">ğŸšš</text>
    <text class="empty-text">æš‚æ— é€è´§å•æ•°æ®</text>
    <button class="btn btn-primary" bindtap="navigateToCreateDelivery">åˆ›å»ºé€è´§å•</button>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && deliveries.length > 0}}">
    <text class="load-more-text" bindtap="loadMore">åŠ è½½æ›´å¤š</text>
  </view>

  <!-- æµ®åŠ¨æŒ‰é’® -->
  <view class="fab" bindtap="navigateToCreateDelivery">
    <text>+</text>
  </view>
</view> 